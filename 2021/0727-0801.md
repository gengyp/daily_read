# [智能营销增益模型(uplift modeling)](https://blog.csdn.net/jinping_shi/article/details/105583375)
## 增益模型 因果与推论（Causal Inference）
1. 点击率预测模型又称响应模型（response model），即预测用户看到商品后点击的概率。
2. 响应模型在智能营销场景为 客户经过营销后响应（购买、绑定等）的概率。营销活动中对客户进行干预称为 treatment 。营销客群分类：
    1. 营销敏感人群（persuadables）：营销才会响应的人群，期望客户
    2. 自然转化（sure thing）：无论是否营销都会转化的人群
    3. 无动于衷（Lost causes）：无论是否营销都不会购买，直接放弃
    4. 反作用（sleeping dogs）：营销反感客群，不建议营销
3. 响应模型无法区分上述人群，营销活动中我们要预测 干预 treatment 的增量，这种模型称为增益模型（uplift model）。设 `G`：某种干预，`X`：用户特征，`Y=1`：响应（购买）
    - response model：`P(Y=1|X)` 营销后购买的概率
    - uplift model:`P(Y=1|X,G)` 因为营销而购买的概率

## 增益模型表示
1. 用户$i$的因果效应(causal effect)：$\tau_i= Y_i(1) - Y_i(0)$ ，即对用户`i`营销后与不营销结果的差；模型目标：最大化 $\tau_i$。
2. 同一用户无法同时观测到营销与不营销的结果，令$\delta_i$为是否营销的二值变量，则用户`i`的观测值为$Y^{obs}_i=\delta_i Y_i(1)+(1-\delta_i)Y_i(0)$
3. 在条件独立的假设下，条件平均因果效应的期望估计值是：$\tau(X_i)=E[Y^{obs}_i|X_i=x,\delta_i=1]-E[Y^{obs}_i|X_i=x,\delta_i=0]$.用户特征$X_i$与干预策略$\delta_i$是相互独立的。一个用户无法同时观测干预与不干预的结果，所以$\tau(X_i)$难以直接优化。

## 差分响应(Differential response)模型(Two-Model Approach)
1. 原理：`A/B test` 独立建模，分别用实验组和对照组分别建立响应模型，两个模型预测分数相减得到 `uplift score`
2. 实验组：干预用户组（treatment）；对照组：未干预用户组（control）。正样本都是响应用户。营销后客户响应的概率-不营销客户响应的概率，即$\tau(X)=E(Y^T|X^T)-E(Y^C|X^C)$，针对每个用户计算$\tau(X_i)$并根据提升分数高低决定是否营销。
3. 优点：原理简单、容易理解。可直接使用现有分类模型。实践中可作为`baseline`
4. 缺点
    1. 模型独立训练，会累计误差
    2. 建模目标为 response 而不是 uplift，因此对 uplift 的预测能力比较邮箱。模拟了$\tau(X_i)$，没有真正优化$\tau(X_i)$。


## 类转化方法（Class Transformation Method）
1. 令$\delta_i$为是否营销的二值变量，`uplift score`可以表示为$\tau(X)=P(Y=1|X,\delta_i=1)-P(Y=1|X,\delta_i=0)=P^T(Y=1|X)-P^C(Y=1|X)$
2. 定义变量$Z=1,(\delta_i=1andY=1)or (\delta_i=0andY=0)$,其余$Z=0$。假设干预策略与用户特征相互独立，即$P(\delta_i|X)=P(\delta_i)$
3. 由全概率公式可得：$P(Z=1|X)=P(Z=1|X,\delta_i=1)P(\delta_i=1|X)+P(Z=1|X,\delta_i=0)P(\delta_i=0|X)=P(Y=1|X,\delta_i=1)P(\delta_i=1|X)+P(Y=0|X,\delta_i=0)P(\delta_i=0|X)=P^T(Y=1|X)P(\delta_i=1)+P^C(Y=0|X)P(\delta_i=0)$
4. 注意到是否干预的概率$P(\delta_i=1),P(\delta_i=0)$是可以通过`A/B test`控制的，在随机化实验中实验组和对照组人数相等，则是否干预的概率均为50%。可得$2P(Z=1|X)=P^T(Y=1|X)+P^C(Y=0|X)=P^T(Y=1|X)+1-P^C(Y=1|X)$，此时`uplift score`为$\tau(X)=P^T(Y=1|X)-P^C(Y=1|X)=2P(Z=1|X)-1$可直接对`Z=1`建模，即实验组中下单的用户和对照组中未下单的用户，因此可以直接将实验组和对照组用户合并，使用一个模型建模。
5. 两个假设
    1. 用户特征与是否营销独立
    2. 每个用户干预与不干预的概率相等，均为$\frac{1}{2}$。可通过重采样是的满足假设
6. 优点：直接套用现有分类模型；两组训练数据共享，学习更充分；避免了双模型的误差累计；直接优化uplift 实用性强
7. 缺点：基础模型仍是响应模型，效果还有提升空间


## 增益模型（uplift modeling）评估
1. 原理：增益模型无法同时观测同一用户干预与否的响应，无法直接计算`precision,recall,AUC`等。一般通过划分10分为数来对齐实验组与对照组，间接评估。
2.  uplift 柱状图(bars)：实验组和对照组分别按照响应分数由高到低排序，并划分十等份。对每一份计算组内响应分数均值，然后相减得到响应10分位的 uplift score，绘制柱状图。只能定性分析
3. Qini曲线(curve)：可在`uplift bars`的基础上绘制`Qini curve`，计算每个bar的Qini系数，相连即得到Qini曲线。Qini系数=实验组topx%累计响应占比-对照组topx%累计响应占比，Qini曲线下面积称为AUUC（Area Under Uplift Curve）。实验组和对照组数量差别过大结果容易失真
4. 累积增益曲线（Cumulative Gain Curve）：（实验组组内累积TopX%响应率-对照组组内累积TopX%响应率）*（实验组组内累积积TopX%人数+对照组组内累积积TopX%人数）

## 优惠券发放Demo
1. 通过一个预测模型对用户响应进行预测，选取响应top10%的用户，构造实验组、对照组
2. 实验组转化率2.69%，对照组转化率2.28%，均高于随机筛选的转化率。此时uplift score = 2.69%-2.28%=0.41%，说明是否发放优惠券对转化率影响较小，所以实验组中营销敏感客群的比例不是很高。
3. uplift bar:为方便将 实验组和对照组20%的测试数据合并作为整个 uplift model的测试集，实验组和对照组均来自同一响应模型，用户特征分布形同。对得到的uplift score $\hat{\tau}(X)$排序，分10箱，计算组内 uplift score 均值，得到 uplift bar。

![img](https://img-blog.csdnimg.cn/20200417170800161.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ppbnBpbmdfc2hp,size_16,color_FFFFFF,t_70)


# [阿里文娱智能营销增益模型(Uplift Model)技术实践](https://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498630&idx=1&sn=b36515e54c2dbc20186942102497c390)
## 智能营销面临的挑战及Uplift Model的价值
1. 智能营销面临的挑战
    - 营销目标：成本有限的情况下，最大化营销产出。
    - 营销挑战：找到真正被营销打动的用户，我们称之为营销敏感人群
2. Uplift Model的价值
    1. Response Model的目标是估计用户看过广告之后转化的概率，这本身是一个相关性，但这个相关性会导致我们没有办法区分出自然转化人群；
    2. Uplift Model是估计用户因为广告而购买的概率，这是一个因果推断的问题，帮助我们锁定对营销敏感的人群。所以Uplift Model是整个智能营销中非常关键的技术，预知每个用户的营销敏感程度，从而帮助我们制定营销策略，促成整个营销的效用最大化。
## Uplift Model建模与评估方法
1. 什么是Uplift Model：增益模型，可表示为两个条件概率的差值，用于预测某种干预对用户行为的因果效应。
    1. 条件独立假设 CIA(Conditional Independence Assumption)
        1. 用户特征与是否干预 独立
        2. 条件平均因果效应(CATE)：$\tau(X_i)=E(Y_i(1)-Y_i(0)|X_i)=E(Y_i|X_i,\delta_i=1)-E(Y_i|X_i,\delta_i=0)$
    2. 建模难点：训练数据不完整，无法同时观测用户干预与不干预的响应结果。
    3. 解决方案：从人群角度对平均英国效应进行统计
        1. 找到两组同质客群，其中一组干预，一组不干预做 `A/B test`
        2. 统计两组转化率差值，作为平均因果效应的近似
    4. 因此，Uplift Model 本质是从训练样本中学习条件的平均因果效应
2. Uplift Model建模算法
    1. Differential response（参考Two-model）
    2. Class Transformation Method（参考上面）
    3. 树模型的uplift modle（modeling Uplift Directly）
        1. 原理：`有时间补充`
        2. 优点：直接量化 uplift，更灵敏精准
        3. 缺点：需要对机器学习模型进行大量改造和优化，实现成本高，暂不考虑
3. Uplift Model建模评估
    1. 难点：单个用户的提升结果无法评估，传统指标不适用
    2. 解法：构造特征相似满足CIA条件假设的两组客群，将干预与否后的差异作为表现结果
    3. 经典指标：AUUC
        1. 对两组客户分别预估 uplift score
        2. 按照 uplift score 降序排列，并按10等份对齐
        3. 计算各个累积分位数 uplift score 的差，可近似认为是真实的 uplift
## Uplift Model在淘票票智能票补中的应用
1. 业务目标：进入淘票票首页用户个性化发放票补，在预算和ROI的约束下，提升平台总体购票转化率
2. 场景特点：`有时间补充`


# [LaTex常用数学符号整理](https://dev-preview.cnblogs.com/RioTian/p/14563284.html)
1. 上标输入法
$$
\hat{a} + \bar{a} + \vec{a} + \tilde{a} + \widehat{a} + \widetilde{a}
$$

> `\hat{a} + \bar{a} + \vec{a} + \tilde{a} + \widehat{a} + \widetilde{a}`

2. 下标输入法

$$ a_{1\ldots{i}\ldots{n}}, a_i$$
> `a_{1\ldots{i}\ldots{n}}, a_i`

3. 小写希腊字母
$$
\alpha + \beta + \gamma+ \delta + \epsilon + \eta \\
\theta+\lambda+\mu+\sigma+\xi+\pi \\
\rho+\tau+\upsilon+\phi+\chi+\psi+\omega
$$
> `\alpha + \beta + \gamma+ \delta + \epsilon + \eta`  \
`\theta+\lambda+\mu+\sigma+\xi+\pi`  \
`\rho+\tau+\upsilon+\phi+\chi+\psi+\omega`

4. 大写希腊字母
$$
\Gamma+\Lambda+\Sigma+\Delta+\Omega \\
\Theta+\Pi+\Phi+\Psi
$$
> `\Gamma+\Lambda+\Sigma+\Delta+\Omega`  \
`\Theta+\Pi+\Phi+\Psi`

5. 二元比较关系
$$
<,\leq,\ll,\subset,\subseteq,\in,\mid,:\\
>,\geq,\gg,\supset,\supseteq,\ni,\parallel,\notin\\
=,\equiv,\doteq,\sim,\simeq,\approx,\cong,\propto,\perp,\neq
$$
> `<,\leq,\ll,\subset,\subseteq,\in,\mid,:`  \
`>,\geq,\gg,\supset,\supseteq,\ni,\parallel,\notin`  \
`=,\equiv,\doteq,\sim,\simeq,\approx,\cong,\propto,\perp,\neq`

6. 二元运算关系
$$
+,-,\times,\div,\pm,\mp,\cdot,\cup,\cap,\vee,\land  \\
\otimes,\bigtriangleup,\bigtriangledown,\star,*,\ast,\circ,\bullet\\
\sum,\sum_{k=1}^nkx, \sum\limits_{k=1}^nkx \\
\bigcup,\bigvee,\prod,\bigcap,\bigwedge,\int,\oint,\int_a^b
$$
> `+,-,\times,\div,\pm,\mp,\cdot,\cup,\cap,\vee,\land`  \
`\otimes,\bigtriangleup,\bigtriangledown,\star,*,\ast,\circ,\bullet`  \
`\sum,\sum_{k=1}^nkx, \sum\limits_{k=1}^nkx`  \
`\bigcup,\bigvee,\prod,\bigcap,\bigwedge,\int,\oint,\int_a^b`

7. 定界符号
$$
\lbrack,[,\{,/,\rbrack \tag{1}
$$
$$
\left\{
    \begin{matrix}
    x+1 & \lambda-1 & x\\
    4 & 5 & 6 \\
    7 & 8 & 10
    \end{matrix}
\right] \tag{2}
$$

$$
\left\{
\begin{array}{c}
x=\dfrac{3\pi}{2}(1+2t)\cos(\dfrac{3\pi}{2}(1+2t)), & \\
y=s, & 0\leq s\leq L,|t|\leq1.\\
z=\dfrac{3\pi}{2}(1+2t)\sin(\dfrac{3\pi}{2}(1+2t)), &
\end{array}
\right. \tag{3}
$$

```
\lbrack,[,\{,/,\rbrack \tag{1}

\left\{
    \begin{matrix}
    x+1 & \lambda-1 & x\\
    4 & 5 & 6 \\
    7 & 8 & 10
    \end{matrix}
\right] \tag{2}

\left\{
\begin{array}{c}
x=\dfrac{3\pi}{2}(1+2t)\cos(\dfrac{3\pi}{2}(1+2t)), & \\
y=s, & 0\leq s\leq L,|t|\leq1.\\
z=\dfrac{3\pi}{2}(1+2t)\sin(\dfrac{3\pi}{2}(1+2t)), &
\end{array}
\right. \tag{3}
```

参考链接
1. [md常用数学符号](https://blog.csdn.net/hiwoshixiaoyu/article/details/102513521)